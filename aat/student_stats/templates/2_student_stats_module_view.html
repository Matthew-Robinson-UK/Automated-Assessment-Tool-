{% extends 'layout.html' %}
{% block title %}
    Student | Module View
{% endblock title %}
{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<link
	rel="stylesheet"
	href="{{url_for('static',filename='student-stats-style.css')}}"
/>
{% endblock extra_head %}
{% block content %}
    <h1>Student Stats for {{current_user.name}} | Module View for "{{module_details["module_title"]}}"</h1>
    <p>
    <a href="{{url_for('student_stats.course_view')}}">
        Course View
    </a>
    > Module View
    </p>   
    <h2>Module: {{module_details["module_title"]}}</h2>
    
    <h2>Status: <span class='{% if module_status=="pass" %}
        text_correct
    {% elif module_status=="fail" %}
        text_incorrect
    {% elif module_status=="unattempted" %}
        text_unattempted
    {% else %}
        text_in_progress
    {% endif %}'>{{module_status | upper }}</span></h2>
    
    <h2>Credits</h2>
    <ul>
        <li>
            <p><b>Total Credits Possible: {{dictionary_of_module_credits["total_credits_possible"]}}</b></p>
        </li>
        <li>
            <p>Total Credits <span class="text_correct"><b>Passed</b></span>: {{dictionary_of_module_credits["total_credits_earned"]}}/{{dictionary_of_module_credits["total_credits_possible"]}}</p>
        </li>
        <li>
            <p>Total Credits <span class="text_incorrect"><b>Failed</b></span>: {{dictionary_of_module_credits["total_credits_failed"]}}/{{dictionary_of_module_credits["total_credits_possible"]}}</p>
        </li>
        <li>
            <p>Total Credits <span class="text_unattempted"><b>Unattempted</b></span>: {{dictionary_of_module_credits["total_credits_unattempted"]}}/{{dictionary_of_module_credits["total_credits_possible"]}}</p>
        </li>
    </ul>
    <div class="content-block">
        <div
            class="chart-container"
        >
            <canvas id="moduleCreditsStudentPi"></canvas>
        </div>
    </div>

    <h2>Assessments</h2>

    <table>
        <tr>
            <th>Assessment</th>
            <th>Type</th>
            <th>Status</th>
            <th>Mark</th>
            <th>Weighted Perc.</th>
            <th>Credits</th>
            <th>Difficulty</th>
            <th>Tags</th>
        </tr>
        {% for a in assessment_stats_overview %}
        <tr>
            <td>
                <li><a href="{{url_for('student_stats.assessment_view', assessment_id=a.assessment_id)}}">{{a.assessment_id}}. {{a.assessment_title}}</a></li>
            </td>
            <td>
                <li>{% if a.summative %}
                    <b>Summative</b>
                    {% else %}
                    Formative
                {% endif %}</li>
            </td>
            <td>
                <li><span class="{{a.status_class}}">{{a.status}}</span></li>
            </td>
            <td>
                <li>{{a.sum_of_marks_earned}}/{{a.sum_of_marks_possible}}</li>
            </td>
            <td>
                {% if weighted_mark %}
                <li>{{ "%.1f" |format(a.weighted_perc*100)}}%</li>
                {% else %}
                    <li>N/A</li>
                {% endif %}
                
            </td>
            <td>
                <li>{% if a.status=="pass" %}{{ a.num_of_credits }}{% else %}0{% endif %}/{{a.num_of_credits}}</li>
            </td>
            <td>
                <li>{{ a.difficulty }}</li>
            </td>
            <td>
                <li>
                    {% if a.tags %}
                        {% for k,v in a.tags.items() %}
                            {{k}} ({{v}}){% if not loop.last %}, {% endif %}
                        {% endfor %}
                    {% else %}
                        None
                    {% endif %}
                   
                </li>
            </td>
        </tr>
        {% endfor %}
    </table>
</ul>
    <h2>Download</h2>
    <p><a href="{{ url_for('student_stats.download')}}">Download CSV</a></p>
        
    <script>
        // OVERALL: STUDENT
        const totalCreditsPassed = '{{dictionary_of_module_credits["total_credits_earned"]}}';
        const totalCreditsFailed = '{{dictionary_of_module_credits["total_credits_failed"]}}';
        const totalCreditsUnattempted = '{{dictionary_of_module_credits["total_credits_unattempted"]}}';
        const moduleCreditsStudentPiElement = document.getElementById('moduleCreditsStudentPi').getContext('2d');
        const moduleCreditsStudentPi = new Chart(moduleCreditsStudentPiElement, {
            type: 'pie',
            data: {
                labels: ['Passed', 'Failed', 'Unattempted'],
                datasets: [
                    {
                        label: 'Course View',
                        data: [totalCreditsPassed, totalCreditsFailed,
                        totalCreditsUnattempted
                        ],
                        backgroundColor: ['rgb(54, 162, 235)', 'rgb(255, 99, 132)','rgb(150, 150, 150)'],
                        hoverOffset: 4,
                    },
                ],
            },
        });
    </script>

{% endblock content %}